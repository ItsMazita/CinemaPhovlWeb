<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gesti√≥n de Boletos - Cinema PHOVL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  :root{
    --bg:#3d0652;           
    --sidebar:#f1e208;      
    --radius:12px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto;
  }

  body{
    margin:0;
    background: var(--bg);
    color:white;
    display:flex;
  }

  /* SIDEBAR */
  .sidebar{
    width:240px;
    background:var(--sidebar);
    color:black;
    padding:20px 0;
    display:flex;
    flex-direction:column;
    position:fixed;
    top:0;
    bottom:0;
    left:0;
    border-right:4px solid black;
  }

  .sidebar a{
    padding:10px 20px;
    display:block;
    color:black;
    font-weight:600;
    text-decoration:none;
  }

  .sidebar a:hover{
    background:#53004f;
    color:var(--sidebar);
  }

  /* CONTENIDO */
  .container{
    margin-left:260px;
    padding:24px;
    width:calc(100% - 260px);
  }

  h2{
    text-align:center;
    font-size:30px;
    color:white;
    text-shadow:2px 2px 5px black;
  }

  /* CAJA DE BOLETOS */
  .ticket-box{
    background:#4b0a63;
    width:60%;
    margin:auto;
    margin-top:30px;
    padding:25px;
    border-radius:15px;
    border:3px solid var(--sidebar);
    box-shadow:0 0 10px black;
  }

  .ticket-section{
    text-align:center;
    margin-bottom:45px;
  }

  .ticket-title{
    font-size:22px;
    font-weight:bold;
    margin-bottom:5px;
  }

  .ticket-price{
    font-size:18px;
    opacity:0.8;
  }

  .ticket-subtotal{
    margin-top:5px;
    font-size:18px;
    font-weight:bold;
    color:#ffe97f;
  }

  .ticket-controls{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:25px;
    margin-top:10px;
  }

  .arrow-btn{
    font-size:32px;
    background:var(--sidebar);
    border:2px solid black;
    border-radius:12px;
    padding:10px 20px;
    cursor:pointer;
    font-weight:bold;
    transition:0.2s;
  }

  .arrow-btn:hover{
    background:white;
  }

  .ticket-value{
    font-size:28px;
    font-weight:bold;
    width:50px;
    text-align:center;
    pointer-events:none;
  }

  /* TOTAL */
  .total{
    text-align:center;
    font-size:26px;
    margin-bottom:20px;
    font-weight:bold;
    padding:10px;
    border-radius:10px;
    background:#3a074d;
    border:2px solid var(--sidebar);
  }

  .btn-continuar{
    width:100%;
    padding:12px;
    background:var(--sidebar);
    border:none;
    border-radius:10px;
    font-size:18px;
    font-weight:bold;
    color:black;
    cursor:pointer;
    margin-top:10px;
    border:2px solid black;
  }

  .btn-continuar:hover{
    background:white;
  }

  .info-funcion{
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#2b043a;
    border:2px solid #f1e208;
    border-radius:12px;
    padding:12px 18px;
    margin-bottom:25px;
    color:#f1e208;
    font-weight:bold;
    font-size:15px;
    box-shadow:0 0 10px black;
    flex-wrap:wrap;
    gap:10px;
  }

  .info-funcion span{
    white-space:nowrap;
  }
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <a href="Pagina Principal.html">Inicio</a>
  <a href="#" onclick="volverASucursal()">‚Üê Volver a Sucursal</a>
</div>

<!-- CONTENIDO -->
<div class="container">
  <h2>Gesti√≥n de Boletos</h2>
  <div id="infoFuncion" class="info-funcion"></div>

  <div class="ticket-box">
    <div id="total" class="total">$0 MXN</div>

    <!-- BOLETOS -->
    <div class="ticket-section">
      <div class="ticket-title">Ni√±os</div>
      <div class="ticket-price">$55 c/u</div>
      <div id="sub_ninos" class="ticket-subtotal">Subtotal: $0 MXN</div>
      <div class="ticket-controls">
        <button class="arrow-btn" onclick="cambiar('ninos', -1)">‚ûñ</button>
        <span id="ninos" class="ticket-value">0</span>
        <button class="arrow-btn" onclick="cambiar('ninos', 1)">‚ûï</button>
      </div>
    </div>

    <div class="ticket-section">
      <div class="ticket-title">Adultos</div>
      <div class="ticket-price">$85 c/u</div>
      <div id="sub_adultos" class="ticket-subtotal">Subtotal: $0 MXN</div>
      <div class="ticket-controls">
        <button class="arrow-btn" onclick="cambiar('adultos', -1)">‚ûñ</button>
        <span id="adultos" class="ticket-value">0</span>
        <button class="arrow-btn" onclick="cambiar('adultos', 1)">‚ûï</button>
      </div>
    </div>

    <div class="ticket-section">
      <div class="ticket-title">Estudiantes</div>
      <div class="ticket-price">$65 c/u</div>
      <div id="sub_estudiantes" class="ticket-subtotal">Subtotal: $0 MXN</div>
      <div class="ticket-controls">
        <button class="arrow-btn" onclick="cambiar('estudiantes', -1)">‚ûñ</button>
        <span id="estudiantes" class="ticket-value">0</span>
        <button class="arrow-btn" onclick="cambiar('estudiantes', 1)">‚ûï</button>
      </div>
    </div>

    <div class="ticket-section">
      <div class="ticket-title">Adultos Mayores</div>
      <div class="ticket-price">$60 c/u</div>
      <div id="sub_mayores" class="ticket-subtotal">Subtotal: $0 MXN</div>
      <div class="ticket-controls">
        <button class="arrow-btn" onclick="cambiar('mayores', -1)">‚ûñ</button>
        <span id="mayores" class="ticket-value">0</span>
        <button class="arrow-btn" onclick="cambiar('mayores', 1)">‚ûï</button>
      </div>
    </div>

    <button class="btn-continuar" onclick="guardarBoletos()">Continuar a Selecci√≥n de Asientos</button>
  </div>
</div>

<script>
  // Par√°metros URL
  const params = new URLSearchParams(window.location.search);
  const sucursal = params.get("sucursal");
  const pelicula = params.get("pelicula");
  const idioma = params.get("idioma");
  const hora = params.get("hora");
  const fecha = params.get("fecha");

  // Normalizar n√∫mero de sucursal
  const sucursalNumero = sucursal ? sucursal.replace(/\D/g,'') : null;

  // ID de funci√≥n para almacenar boletos
  const funcionID = `${pelicula}_${sucursal}_${fecha}_${hora}`;
  localStorage.setItem("funcionSeleccionada", funcionID);

  // Mostrar informaci√≥n de la funci√≥n
  const info = document.getElementById("infoFuncion");
  if(sucursal && pelicula && fecha){
    const fechaBonita = new Date(fecha + "T00:00").toLocaleDateString("es-MX", {
      weekday:"long",
      day:"numeric",
      month:"long",
      year:"numeric"
    });
    info.innerHTML = `
     <span>üè¢ ${sucursal}</span>
     <span>üé¨ ${pelicula}</span>
      <span>üïó ${hora}</span>
      <span>üåé ${idioma}</span>
      <span>üìÖ ${fechaBonita}</span>
    `;
  } else {
    info.innerHTML = "Funci√≥n no v√°lida";
  }

  // Datos y precios
  const precios = { ninos:55, adultos:85, estudiantes:65, mayores:60 };
  const datos = JSON.parse(localStorage.getItem("boletos_" + funcionID)) || {ninos:0, adultos:0, estudiantes:0, mayores:0};

  // Inicializar valores
  ["ninos","adultos","estudiantes","mayores"].forEach(id => {
    document.getElementById(id).textContent = datos[id];
  });

  // Cambiar cantidad de boletos
  function cambiar(id, amount){
    let valor = parseInt(document.getElementById(id).textContent) + amount;
    if(valor < 0) valor = 0;
    document.getElementById(id).textContent = valor;
    actualizarSubtotales();
    actualizarTotal();
  }

  function actualizarSubtotales(){
    document.getElementById("sub_ninos").textContent = `Subtotal: $${(datos.ninos = parseInt(document.getElementById("ninos").textContent))*precios.ninos} MXN`;
    document.getElementById("sub_adultos").textContent = `Subtotal: $${(datos.adultos = parseInt(document.getElementById("adultos").textContent))*precios.adultos} MXN`;
    document.getElementById("sub_estudiantes").textContent = `Subtotal: $${(datos.estudiantes = parseInt(document.getElementById("estudiantes").textContent))*precios.estudiantes} MXN`;
    document.getElementById("sub_mayores").textContent = `Subtotal: $${(datos.mayores = parseInt(document.getElementById("mayores").textContent))*precios.mayores} MXN`;
  }

  function actualizarTotal(){
    const total = datos.ninos*precios.ninos + datos.adultos*precios.adultos + datos.estudiantes*precios.estudiantes + datos.mayores*precios.mayores;
    document.getElementById("total").textContent = `$${total} MXN`;
  }

  function guardarBoletos(){
    localStorage.setItem("boletos_" + funcionID, JSON.stringify(datos));
    window.location.href = "seleccion_asientos.html";
  }

  // Funci√≥n para volver a la sucursal correspondiente
  function volverASucursal() {
    const sucursales = { "1":"sucursal1.html", "2":"sucursal2.html", "3":"sucursal3.html" };
    if(sucursalNumero && sucursales[sucursalNumero]){
        window.location.href = sucursales[sucursalNumero];
    } else {
        window.location.href = "Pagina Principal.html";
    }
  }

  // Inicializar totales
  actualizarSubtotales();
  actualizarTotal();

</script>

</body>
</html>
